<!DOCTYPE html>
<html lang="en-AU">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Game Events | p(Doom)1</title>
	<link rel="canonical" href="https://pdoom1.com/events/" />
	<meta name="description" content="Explore all timeline events in p(Doom)1 - from FTX collapse to AI alignment breakthroughs. Browse, filter, and suggest modifications to in-game events." />

	<!-- Plausible Analytics -->
	<script defer data-domain="pdoom1.com" src="https://analytics.pdoom1.com/js/script.file-downloads.outbound-links.pageview-props.tagged-events.js"></script>
	<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

	<link rel="stylesheet" href="/css/site.css">
	<style>
		:root {
			--bg-primary: #1a1a1a;
			--bg-secondary: #2d2d2d;
			--bg-tertiary: #3d3d3d;
			--text-primary: #ffffff;
			--text-secondary: #cccccc;
			--text-muted: #aaaaaa;
			--accent-primary: #00ff41;
			--accent-secondary: #ff6b35;
			--accent-danger: #ff4444;
			--border-color: #444444;
			--success-color: #4caf50;
			--radius-md: 6px;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Courier New', monospace;
			background: var(--bg-primary);
			color: var(--text-primary);
			line-height: 1.6;
		}

		header {
			background: rgba(45, 45, 45, 0.95);
			backdrop-filter: blur(10px);
			border-bottom: 2px solid var(--accent-primary);
			padding: 0.8rem 0;
			position: sticky;
			top: 0;
			z-index: 100;
		}

		nav {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 1rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.logo {
			font-size: 1.5rem;
			font-weight: bold;
			color: var(--accent-primary);
			text-decoration: none;
			text-shadow: 0 0 10px var(--accent-primary);
		}

		.nav-links {
			display: flex;
			gap: 1rem;
			list-style: none;
		}

		.nav-links a {
			color: var(--text-secondary);
			text-decoration: none;
			transition: color 0.3s;
			padding: 0.5rem;
		}

		.nav-links a:hover {
			color: var(--accent-primary);
		}

		main {
			max-width: 1200px;
			margin: 0 auto;
			padding: 1rem 1rem;
		}

		.page-header {
			text-align: center;
			margin-bottom: 1rem;
		}

		.page-header h1 {
			font-size: 2rem;
			color: var(--accent-primary);
			margin-bottom: 0.3rem;
			text-shadow: 0 0 20px var(--accent-primary);
		}

		.page-header p {
			color: var(--text-secondary);
			font-size: 0.95rem;
			max-width: 800px;
			margin: 0 auto 0.5rem;
		}

		.contribute-banner {
			background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
			border: 1px solid var(--accent-secondary);
			border-radius: var(--radius-md);
			padding: 0.75rem;
			margin-bottom: 0.5rem;
			text-align: center;
		}

		.contribute-banner h2 {
			color: var(--accent-secondary);
			margin-bottom: 0.3rem;
			font-size: 1.1rem;
		}

		.contribute-banner p {
			margin-bottom: 0.5rem;
			font-size: 0.9rem;
		}

		.contribute-banner .cta-button {
			display: inline-block;
			background: var(--accent-secondary);
			color: var(--bg-primary);
			padding: 0.4rem 0.8rem;
			text-decoration: none;
			border-radius: 4px;
			font-weight: bold;
			margin: 0.25rem;
			transition: transform 0.3s;
			font-size: 0.85rem;
		}

		.contribute-banner .cta-button:hover {
			transform: translateY(-2px);
		}

		.filters {
			background: var(--bg-secondary);
			padding: 0.75rem;
			border-radius: var(--radius-md);
			margin-bottom: 0.5rem;
			border: 1px solid var(--border-color);
		}

		.filter-group {
			margin-bottom: 0.5rem;
		}

		.filter-group label {
			display: block;
			color: var(--accent-primary);
			margin-bottom: 0.25rem;
			font-weight: bold;
			font-size: 0.9rem;
		}

		.filter-buttons {
			display: flex;
			gap: 0.35rem;
			flex-wrap: wrap;
		}

		.view-toggle {
			display: flex;
			gap: 0.35rem;
			margin-bottom: 0.5rem;
		}

		.view-btn {
			background: var(--bg-tertiary);
			border: 1px solid var(--border-color);
			color: var(--text-secondary);
			padding: 0.3rem 0.6rem;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.3s;
			font-family: inherit;
			font-size: 0.85rem;
		}

		.view-btn.active {
			background: var(--accent-primary);
			color: var(--bg-primary);
			border-color: var(--accent-primary);
		}

		.filter-btn {
			background: var(--bg-tertiary);
			border: 1px solid var(--border-color);
			color: var(--text-secondary);
			padding: 0.3rem 0.6rem;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.3s;
			font-family: inherit;
			font-size: 0.85rem;
		}

		.filter-btn:hover {
			border-color: var(--accent-primary);
			color: var(--accent-primary);
		}

		.filter-btn.active {
			background: var(--accent-primary);
			color: var(--bg-primary);
			border-color: var(--accent-primary);
		}

		.search-box {
			width: 100%;
			padding: 0.5rem;
			background: var(--bg-tertiary);
			border: 1px solid var(--border-color);
			border-radius: 4px;
			color: var(--text-primary);
			font-family: inherit;
			font-size: 0.9rem;
		}

		.search-box:focus {
			outline: none;
			border-color: var(--accent-primary);
		}

		.events-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 0.75rem;
			margin-top: 0.5rem;
		}

		.event-card {
			background: var(--bg-secondary);
			border: 1px solid var(--border-color);
			border-radius: var(--radius-md);
			padding: 0.75rem;
			transition: all 0.3s;
			cursor: pointer;
			position: relative;
		}

		.event-card:hover {
			transform: translateY(-5px);
			border-color: var(--accent-primary);
			box-shadow: 0 4px 12px rgba(0, 255, 65, 0.2);
		}

		.event-icon {
			width: 48px;
			height: 48px;
			margin-bottom: 0.4rem;
			border-radius: 6px;
			background: var(--bg-tertiary);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1.5rem;
		}

		.event-category {
			display: inline-block;
			background: var(--bg-tertiary);
			color: var(--accent-secondary);
			padding: 0.15rem 0.5rem;
			border-radius: 3px;
			font-size: 0.7rem;
			font-weight: bold;
			text-transform: uppercase;
			margin-bottom: 0.4rem;
			border: 1px solid var(--accent-secondary);
		}

		.event-title {
			color: var(--accent-primary);
			font-size: 1rem;
			margin-bottom: 0.25rem;
			font-weight: bold;
			line-height: 1.3;
		}

		.event-year {
			color: var(--text-muted);
			font-size: 0.8rem;
			margin-bottom: 0.4rem;
		}

		.event-description {
			color: var(--text-secondary);
			margin-bottom: 0.5rem;
			line-height: 1.4;
			font-size: 0.85rem;
		}

		.event-tags {
			display: flex;
			gap: 0.35rem;
			flex-wrap: wrap;
			margin-bottom: 0.5rem;
		}

		.event-tag {
			background: var(--bg-primary);
			color: var(--text-muted);
			padding: 0.15rem 0.4rem;
			border-radius: 3px;
			font-size: 0.7rem;
		}

		.event-rarity {
			position: absolute;
			top: 0.6rem;
			right: 0.6rem;
			font-size: 1rem;
		}

		.rarity-common { opacity: 0.6; }
		.rarity-rare { opacity: 0.9; }
		.rarity-legendary {
			animation: pulse-legendary 2s infinite;
		}

		@keyframes pulse-legendary {
			0%, 100% { opacity: 1; transform: scale(1); }
			50% { opacity: 0.8; transform: scale(1.1); }
		}

		.event-impacts {
			display: flex;
			gap: 0.35rem;
			flex-wrap: wrap;
			margin-top: 0.5rem;
			padding-top: 0.5rem;
			border-top: 1px solid var(--border-color);
		}

		.impact-badge {
			background: var(--bg-tertiary);
			padding: 0.2rem 0.4rem;
			border-radius: 3px;
			font-size: 0.7rem;
			display: flex;
			align-items: center;
			gap: 0.25rem;
		}

		.impact-positive {
			color: var(--success-color);
		}

		.impact-negative {
			color: var(--accent-danger);
		}

		.loading {
			text-align: center;
			padding: 3rem;
			color: var(--text-muted);
		}

		.stats-bar {
			display: flex;
			justify-content: space-around;
			background: var(--bg-secondary);
			padding: 0.75rem;
			border-radius: var(--radius-md);
			margin-bottom: 0.5rem;
			border: 1px solid var(--border-color);
		}

		.stat-item {
			text-align: center;
		}

		.stat-number {
			font-size: 1.5rem;
			font-weight: bold;
			color: var(--accent-primary);
			display: block;
		}

		.stat-label {
			color: var(--text-muted);
			font-size: 0.75rem;
		}

		.bulk-toolbar {
			background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
			border-radius: var(--radius-md);
			padding: 0.5rem 0.75rem;
			margin-bottom: 0.5rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 2px 8px rgba(255, 107, 53, 0.2);
		}

		.bulk-info {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.bulk-select-all {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			cursor: pointer;
			color: white;
			font-weight: bold;
		}

		.bulk-select-all input[type="checkbox"] {
			width: 20px;
			height: 20px;
			cursor: pointer;
		}

		.bulk-actions {
			display: flex;
			gap: 0.75rem;
		}

		.event-card {
			position: relative;
		}

		.event-checkbox {
			position: absolute;
			top: 0.5rem;
			left: 0.5rem;
			z-index: 10;
		}

		.event-checkbox input[type="checkbox"] {
			width: 18px;
			height: 18px;
			cursor: pointer;
			accent-color: var(--accent-primary);
		}

		.event-card.selected {
			outline: 3px solid var(--accent-primary);
			outline-offset: -3px;
		}

		/* Table View Styles */
		.events-table {
			width: 100%;
			border-collapse: collapse;
			background: var(--bg-secondary);
			border-radius: var(--radius-md);
			overflow: hidden;
			font-size: 0.85rem;
		}

		.events-table thead {
			background: var(--bg-tertiary);
			border-bottom: 2px solid var(--accent-primary);
		}

		.events-table th {
			padding: 0.5rem;
			text-align: left;
			color: var(--accent-primary);
			font-weight: bold;
			font-size: 0.8rem;
			white-space: nowrap;
		}

		.events-table td {
			padding: 0.4rem 0.5rem;
			border-bottom: 1px solid var(--border-color);
			color: var(--text-secondary);
		}

		.events-table tbody tr {
			cursor: pointer;
			transition: background 0.2s;
		}

		.events-table tbody tr:hover {
			background: var(--bg-tertiary);
		}

		.events-table tbody tr.selected {
			background: rgba(0, 255, 65, 0.1);
			border-left: 3px solid var(--accent-primary);
		}

		.table-checkbox {
			width: 18px;
			height: 18px;
			cursor: pointer;
			accent-color: var(--accent-primary);
		}

		.table-title {
			color: var(--accent-primary);
			font-weight: bold;
		}

		.table-category {
			font-size: 0.75rem;
			padding: 0.15rem 0.4rem;
			border-radius: 3px;
			background: var(--bg-tertiary);
			color: var(--accent-secondary);
			display: inline-block;
			white-space: nowrap;
		}

		.table-rarity {
			font-size: 0.9rem;
		}

		.table-impacts {
			font-size: 0.75rem;
			color: var(--text-muted);
		}

		footer {
			background: var(--bg-secondary);
			border-top: 2px solid var(--accent-primary);
			text-align: center;
			padding: 1rem 1rem;
			margin-top: 1.5rem;
			color: var(--text-muted);
			font-size: 0.85rem;
		}
	</style>
</head>
<body>
	<header>
		<nav>
			<a href="/" class="logo">p(Doom)1</a>
			<ul class="nav-links">
				<li><a href="/">Home</a></li>
				<li><a href="/events/">Events</a></li>
				<li><a href="/leaderboard/">Leaderboard</a></li>
				<li><a href="/game-stats/">Stats</a></li>
				<li><a href="/docs/">Docs</a></li>
			</ul>
		</nav>
	</header>

	<main>
		<div class="page-header">
			<h1>üìÖ Game Events Timeline</h1>
			<p>Explore real-world AI safety events that shape the game. From funding catastrophes to breakthrough discoveries, each event impacts your strategy.</p>
		</div>

		<!-- Contribution Banner -->
		<div class="contribute-banner">
			<h2>ü§ù Help Improve Event Data</h2>
			<p>Many events have <strong style="color: #ff9800;">‚ö†Ô∏è placeholder quotes</strong> that need replacing with real reactions from researchers and media. <a href="/docs/CONTRIBUTING_TO_EVENTS.html" style="color: var(--accent-primary); text-decoration: underline; font-weight: bold;">Learn how to contribute ‚Üí</a></p>
			<a href="/docs/CONTRIBUTING_TO_EVENTS.html" class="cta-button">üìñ Contribution Guide</a>
			<a href="/events/suggest-metadata.html" class="cta-button">üìù Suggest Metadata</a>
			<a href="https://github.com/PipFoweraker/pdoom-data/issues/new" class="cta-button" target="_blank">Suggest New Event</a>
		</div>

		<!-- Stats Bar -->
		<div class="stats-bar">
			<div class="stat-item">
				<span class="stat-number" id="total-events">...</span>
				<span class="stat-label">Total Events</span>
			</div>
			<div class="stat-item">
				<span class="stat-number" id="categories-count">...</span>
				<span class="stat-label">Categories</span>
			</div>
			<div class="stat-item">
				<span class="stat-number" id="legendary-count">...</span>
				<span class="stat-label">Legendary Events</span>
			</div>
			<div class="stat-item">
				<span class="stat-number" id="latest-year">...</span>
				<span class="stat-label">Latest Event Year</span>
			</div>
		</div>

		<!-- Filters -->
		<div class="filters">
			<div class="filter-group">
				<label>üîç Search Events</label>
				<input type="text" class="search-box" id="search-box" placeholder="Search by title, description, tags...">
			</div>

			<div class="filter-group">
				<label>üìÅ Category</label>
				<div class="filter-buttons" id="category-filters">
					<button class="filter-btn active" data-filter="all">All</button>
					<button class="filter-btn" data-filter="funding_catastrophe">üí∏ Funding Catastrophe</button>
					<button class="filter-btn" data-filter="organizational_crisis">üè¢ Organizational Crisis</button>
					<button class="filter-btn" data-filter="technical_research_breakthrough">üî¨ Research Breakthrough</button>
					<button class="filter-btn" data-filter="institutional_decay">‚ö†Ô∏è Institutional Decay</button>
				</div>
			</div>

			<div class="filter-group">
				<label>‚≠ê Rarity</label>
				<div class="filter-buttons" id="rarity-filters">
					<button class="filter-btn active" data-filter="all">All</button>
					<button class="filter-btn" data-filter="common">Common</button>
					<button class="filter-btn" data-filter="rare">Rare</button>
					<button class="filter-btn" data-filter="legendary">Legendary ‚ú®</button>
				</div>
			</div>

			<div class="filter-group">
				<label>üìÖ Year Range</label>
				<div class="filter-buttons" id="year-filters">
					<button class="filter-btn active" data-filter="all">All</button>
					<button class="filter-btn" data-filter="2016-2020">2016-2020</button>
					<button class="filter-btn" data-filter="2021-2023">2021-2023</button>
					<button class="filter-btn" data-filter="2024+">2024+</button>
				</div>
			</div>
		</div>

		<!-- Bulk Actions Toolbar -->
		<div class="bulk-toolbar" id="bulk-toolbar" style="display: none;">
			<div class="bulk-info">
				<label class="bulk-select-all">
					<input type="checkbox" id="select-all-checkbox">
					<span id="selection-count">0 selected</span>
				</label>
			</div>
			<div class="bulk-actions">
				<button class="cta-button secondary" onclick="clearSelection()">Clear Selection</button>
				<button class="cta-button" onclick="bulkSuggestMetadata()">üìù Suggest Metadata for Selected</button>
			</div>
		</div>

		<!-- Events Grid -->
		<div id="events-container">
			<div class="loading">Loading events...</div>
		</div>
	</main>

	<footer>
		<p>&copy; 2025 p(Doom)1 | <a href="https://github.com/PipFoweraker/pdoom1" style="color: var(--accent-primary);">GitHub</a> | <a href="/privacy/" style="color: var(--accent-primary);">Privacy</a></p>
		<p style="margin-top: 0.5rem; font-size: 0.9rem;">Events data from <a href="https://github.com/PipFoweraker/pdoom-data" target="_blank" style="color: var(--accent-secondary);">pdoom-data</a></p>
	</footer>

	<script>
		// TODO: This will be populated by sync script
		let eventsData = {};
		let filteredEvents = {};
		let currentFilters = {
			category: 'all',
			rarity: 'all',
			year: 'all',
			search: ''
		};

		// Category icons mapping
		const categoryIcons = {
			'funding_catastrophe': 'üí∏',
			'organizational_crisis': 'üè¢',
			'technical_research_breakthrough': 'üî¨',
			'institutional_decay': '‚ö†Ô∏è',
			'policy_development': 'üìú',
			'public_awareness': 'üì¢',
			'capability_advance': 'üöÄ',
			'alignment_breakthrough': 'üéØ',
			'governance_milestone': '‚öñÔ∏è'
		};

		const rarityEmoji = {
			'common': '‚ö™',
			'rare': 'üîµ',
			'legendary': '‚ú®'
		};

		// Load events from data file
		async function loadEvents() {
			try {
				const response = await fetch('/data/events.json');
				if (!response.ok) {
					throw new Error('Events data not yet synced');
				}
				eventsData = await response.json();
				filteredEvents = { ...eventsData };
				updateStats();
				renderEvents();
			} catch (error) {
				console.error('Error loading events:', error);
				document.getElementById('events-container').innerHTML = `
					<div class="loading">
						<p>‚ö†Ô∏è Events data not yet synced from pdoom-data repository.</p>
						<p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
							Run <code style="background: var(--bg-tertiary); padding: 0.2rem 0.5rem; border-radius: 3px;">npm run sync:events</code> to populate event data.
						</p>
						<p style="margin-top: 1rem;">
							<a href="https://github.com/PipFoweraker/pdoom-data" target="_blank" style="color: var(--accent-primary);">View pdoom-data repository ‚Üí</a>
						</p>
					</div>
				`;
			}
		}

		function updateStats() {
			const events = Object.values(eventsData);
			const categories = new Set(events.map(e => e.category)).size;
			const legendary = events.filter(e => e.rarity === 'legendary').length;
			const latestYear = Math.max(...events.map(e => e.year));

			document.getElementById('total-events').textContent = events.length;
			document.getElementById('categories-count').textContent = categories;
			document.getElementById('legendary-count').textContent = legendary;
			document.getElementById('latest-year').textContent = latestYear;
		}

		function filterEvents() {
			const events = Object.entries(eventsData);

			filteredEvents = Object.fromEntries(
				events.filter(([id, event]) => {
					// Category filter
					if (currentFilters.category !== 'all' && event.category !== currentFilters.category) {
						return false;
					}

					// Rarity filter
					if (currentFilters.rarity !== 'all' && event.rarity !== currentFilters.rarity) {
						return false;
					}

					// Year filter
					if (currentFilters.year !== 'all') {
						if (currentFilters.year === '2016-2020' && (event.year < 2016 || event.year > 2020)) return false;
						if (currentFilters.year === '2021-2023' && (event.year < 2021 || event.year > 2023)) return false;
						if (currentFilters.year === '2024+' && event.year < 2024) return false;
					}

					// Search filter
					if (currentFilters.search) {
						const searchLower = currentFilters.search.toLowerCase();
						const matchesTitle = event.title.toLowerCase().includes(searchLower);
						const matchesDescription = event.description.toLowerCase().includes(searchLower);
						const matchesTags = event.tags.some(tag => tag.toLowerCase().includes(searchLower));

						if (!matchesTitle && !matchesDescription && !matchesTags) {
							return false;
						}
					}

					return true;
				})
			);

			renderEvents();
		}

		function renderEvents() {
			const container = document.getElementById('events-container');
			const events = Object.values(filteredEvents);

			if (events.length === 0) {
				container.innerHTML = '<div class="loading">No events match your filters. Try adjusting your search criteria.</div>';
				return;
			}

			// Sort by year (descending) then by rarity
			events.sort((a, b) => {
				if (b.year !== a.year) return b.year - a.year;
				const rarityOrder = { 'legendary': 3, 'rare': 2, 'common': 1 };
				return rarityOrder[b.rarity] - rarityOrder[a.rarity];
			});

			// Create table
			const table = document.createElement('table');
			table.className = 'events-table';

			// Table header
			table.innerHTML = `
				<thead>
					<tr>
						<th style="width: 30px;"><input type="checkbox" id="table-select-all" class="table-checkbox"></th>
						<th style="width: 50px;">Year</th>
						<th>Title</th>
						<th style="width: 150px;">Category</th>
						<th style="width: 60px;">Rarity</th>
						<th style="width: 80px;">Impacts</th>
					</tr>
				</thead>
				<tbody></tbody>
			`;

			const tbody = table.querySelector('tbody');

			events.forEach(event => {
				const row = createEventRow(event);
				tbody.appendChild(row);
			});

			container.innerHTML = '';
			container.appendChild(table);

			// Setup table select-all
			document.getElementById('table-select-all').addEventListener('change', function() {
				const checkboxes = document.querySelectorAll('.table-checkbox[data-event-id]');
				checkboxes.forEach(cb => {
					if (this.checked && !cb.checked) {
						cb.checked = true;
						toggleEventSelection(cb.dataset.eventId);
					} else if (!this.checked && cb.checked) {
						cb.checked = false;
						toggleEventSelection(cb.dataset.eventId);
					}
				});
			});
		}

		function createEventCard(event) {
			const card = document.createElement('div');
			card.className = 'event-card';
			card.dataset.eventId = event.id;

			const icon = categoryIcons[event.category] || 'üìå';
			const rarity = rarityEmoji[event.rarity] || '‚ö™';

			// Calculate impact summary
			const impactsHTML = event.impacts.slice(0, 5).map(impact => {
				const sign = impact.change > 0 ? '+' : '';
				const colorClass = impact.change > 0 ? 'impact-positive' : 'impact-negative';
				return `<span class="impact-badge"><span class="${colorClass}">${sign}${impact.change}</span> ${impact.variable}</span>`;
			}).join('');

			card.innerHTML = `
				<div class="event-checkbox">
					<input type="checkbox" data-event-id="${event.id}" onclick="event.stopPropagation(); toggleEventSelection('${event.id}')">
				</div>
				<div class="event-rarity rarity-${event.rarity}">${rarity}</div>
				<div class="event-icon">${icon}</div>
				<div class="event-category">${event.category.replace(/_/g, ' ')}</div>
				<h3 class="event-title">${event.title}</h3>
				<div class="event-year">üìÖ ${event.year}</div>
				<p class="event-description">${event.description.substring(0, 150)}${event.description.length > 150 ? '...' : ''}</p>
				<div class="event-tags">
					${event.tags.slice(0, 4).map(tag => `<span class="event-tag">#${tag}</span>`).join('')}
				</div>
				<div class="event-impacts">
					${impactsHTML}
					${event.impacts.length > 5 ? `<span class="impact-badge">+${event.impacts.length - 5} more</span>` : ''}
				</div>
			`;

			// Click handler for card (not checkbox)
			card.onclick = (e) => {
				if (!e.target.matches('input[type="checkbox"]')) {
					window.location.href = `/events/${event.id}.html`;
				}
			};

			return card;
		}

		function createEventRow(event) {
			const row = document.createElement('tr');
			row.dataset.eventId = event.id;

			const icon = categoryIcons[event.category] || 'üìå';
			const rarity = rarityEmoji[event.rarity] || '‚ö™';

			const impactCount = event.impacts.length;
			const impactSummary = impactCount > 0 ? `${impactCount} changes` : 'None';

			row.innerHTML = `
				<td><input type="checkbox" class="table-checkbox" data-event-id="${event.id}" onclick="event.stopPropagation(); toggleEventSelection('${event.id}')"></td>
				<td>${event.year}</td>
				<td><span class="table-title">${event.title}</span></td>
				<td><span class="table-category">${icon} ${event.category.replace(/_/g, ' ')}</span></td>
				<td class="table-rarity">${rarity}</td>
				<td class="table-impacts">${impactSummary}</td>
			`;

			// Click handler for row (not checkbox)
			row.onclick = (e) => {
				if (!e.target.matches('input[type="checkbox"]')) {
					window.location.href = `/events/${event.id}.html`;
				}
			};

			return row;
		}

		// Setup filter buttons
		function setupFilters() {
			document.querySelectorAll('#category-filters .filter-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					document.querySelectorAll('#category-filters .filter-btn').forEach(b => b.classList.remove('active'));
					btn.classList.add('active');
					currentFilters.category = btn.dataset.filter;
					filterEvents();
				});
			});

			document.querySelectorAll('#rarity-filters .filter-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					document.querySelectorAll('#rarity-filters .filter-btn').forEach(b => b.classList.remove('active'));
					btn.classList.add('active');
					currentFilters.rarity = btn.dataset.filter;
					filterEvents();
				});
			});

			document.querySelectorAll('#year-filters .filter-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					document.querySelectorAll('#year-filters .filter-btn').forEach(b => b.classList.remove('active'));
					btn.classList.add('active');
					currentFilters.year = btn.dataset.filter;
					filterEvents();
				});
			});

			document.getElementById('search-box').addEventListener('input', (e) => {
				currentFilters.search = e.target.value;
				filterEvents();
			});
		}

		// Bulk selection functionality
		let selectedEvents = new Set();

		function toggleEventSelection(eventId) {
			const checkbox = document.querySelector(`input[data-event-id="${eventId}"]`);
			const row = document.querySelector(`tr[data-event-id="${eventId}"]`);

			if (checkbox.checked) {
				selectedEvents.add(eventId);
				if (row) row.classList.add('selected');
			} else {
				selectedEvents.delete(eventId);
				if (row) row.classList.remove('selected');
			}

			updateBulkToolbar();
		}

		function updateBulkToolbar() {
			const toolbar = document.getElementById('bulk-toolbar');
			const count = document.getElementById('selection-count');
			const selectAllCheckbox = document.getElementById('select-all-checkbox');
			const tableSelectAll = document.getElementById('table-select-all');

			count.textContent = `${selectedEvents.size} selected`;

			if (selectedEvents.size > 0) {
				toolbar.style.display = 'flex';
			} else {
				toolbar.style.display = 'none';
			}

			// Update select-all checkbox state
			const allCheckboxes = document.querySelectorAll('.table-checkbox[data-event-id]');
			if (selectAllCheckbox) {
				selectAllCheckbox.checked = allCheckboxes.length > 0 && selectedEvents.size === allCheckboxes.length;
				selectAllCheckbox.indeterminate = selectedEvents.size > 0 && selectedEvents.size < allCheckboxes.length;
			}
			if (tableSelectAll) {
				tableSelectAll.checked = allCheckboxes.length > 0 && selectedEvents.size === allCheckboxes.length;
				tableSelectAll.indeterminate = selectedEvents.size > 0 && selectedEvents.size < allCheckboxes.length;
			}
		}

		function clearSelection() {
			selectedEvents.clear();
			document.querySelectorAll('.table-checkbox[data-event-id]').forEach(cb => cb.checked = false);
			document.querySelectorAll('tr[data-event-id]').forEach(row => row.classList.remove('selected'));
			document.getElementById('table-select-all').checked = false;
			updateBulkToolbar();
		}

		function bulkSuggestMetadata() {
			if (selectedEvents.size === 0) {
				alert('Please select at least one event first');
				return;
			}

			// Track analytics event
			if (window.plausible) {
				plausible('Bulk Metadata Suggestion', {
					props: {
						event_count: selectedEvents.size,
						method: 'bulk_selection'
					}
				});
			}

			// Get selected event details
			const events = Array.from(selectedEvents).map(id => {
				const event = eventsData[id];
				return {
					id: id,
					title: event.title,
					year: event.year,
					category: event.category,
					rarity: event.rarity
				};
			});

			// Create bulk suggestion text
			let body = `# Bulk Metadata Suggestion for ${events.length} Events\n\n`;
			body += `## Selected Events\n\n`;
			events.forEach((e, i) => {
				body += `${i + 1}. **${e.title}** (${e.year})\n`;
				body += `   - ID: \`${e.id}\`\n`;
				body += `   - Category: ${e.category}\n`;
				body += `   - Rarity: ${e.rarity}\n\n`;
			});
			body += `## Proposed Changes\n\n`;
			body += `<!-- Describe what metadata changes you'd like to apply to these events -->\n\n`;
			body += `**Category Change:**\n- [ ] Change all to: _______\n\n`;
			body += `**Rarity Change:**\n- [ ] Change all to: _______\n\n`;
			body += `**Tags to Add:**\n- [ ] Add tags: _______\n\n`;
			body += `**Game Impact Adjustments:**\n- [ ] Describe impact changes: _______\n\n`;
			body += `**p(Doom) Impact:**\n- [ ] Set to: _______\n\n`;
			body += `## Reason\n\n`;
			body += `<!-- Explain why these changes would improve the event metadata -->\n\n`;
			body += `---\n`;
			body += `Submitted via bulk selection on pdoom1.com/events/`;

			const title = `Bulk Metadata: ${events.length} events`;
			const labels = 'metadata,events,bulk-suggestion';

			const issueUrl = `https://github.com/PipFoweraker/pdoom-data/issues/new?` +
				`labels=${encodeURIComponent(labels)}&` +
				`title=${encodeURIComponent(title)}&` +
				`body=${encodeURIComponent(body)}`;

			// Open GitHub issue
			window.open(issueUrl, '_blank');
		}

		// Select all functionality
		document.addEventListener('DOMContentLoaded', () => {
			document.getElementById('select-all-checkbox').addEventListener('change', function() {
				const checkboxes = document.querySelectorAll('.event-checkbox input[type="checkbox"]');

				if (this.checked) {
					// Select all visible events
					checkboxes.forEach(cb => {
						if (!cb.checked) {
							cb.checked = true;
							toggleEventSelection(cb.dataset.eventId);
						}
					});
				} else {
					// Deselect all
					clearSelection();
				}
			});
		});

		// Initialize
		document.addEventListener('DOMContentLoaded', () => {
			setupFilters();
			loadEvents();
		});
	</script>
</body>
</html>
